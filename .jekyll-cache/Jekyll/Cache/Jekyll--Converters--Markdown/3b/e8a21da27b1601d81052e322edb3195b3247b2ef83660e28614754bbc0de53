I"<p>A primer on developing private NPM packages.</p>

<h1 id="packages-galore">Packages galore</h1>

<p>Outlined are the procedures and guidelines for private NPM package development. This guide is inspired by an old dev team I was on, and frankly this has served me time and time again when working on internal packages.</p>

<p>One of the fundamental principles a Web Development team should embrace is the software programming ideals behind the old Unix philosophy - You should strive to build short, clear, modular, reusable, composable, and extensible code whenever possible.</p>

<p>Certainly, the best way to realize such ideals is by taking full advantage of NPM by using NPM for importing 3rd-party open-source packages. Additionally, it is also used to manage and host one‚Äôs own internal shared libraries as private NPM packages.</p>

<h2 id="setup">Setup</h2>

<p>To keep things simple, imagine you‚Äôve just joined a new team as a Full Stack Engineer - congrats! üéâ The project tech stack has several private NPM packages specific to your team‚Äôs application, perfect for this guide!</p>

<p>The typical first steps when working on a new project or onboarding with a new team would be to clone the project repository and run <code class="highlighter-rouge">npm install</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/&lt;user-name&gt;/&lt;project&gt;.git
<span class="nv">$ </span><span class="nb">cd</span> &lt;project&gt;/
<span class="nv">$ </span>npm <span class="nb">install</span>
</code></pre></div></div>

<p>You‚Äôll also need to set up the <code class="highlighter-rouge">NPM_TOKEN</code> environment variable, which holds the NPM access token used for reading packages from, and publishing packages to, your NPM organization. More on this later.</p>

<h2 id="basic-workflow">Basic Workflow</h2>

<p>Let‚Äôs talk about workflows‚Ä¶ Every organization is different, and there might be some extra steps that aren‚Äôt present from this example workflow. However, the fundamentals of this workflow will get you by swimmingly!</p>

<p>An example of a typical development workflow might look like the following:</p>

<ol>
  <li>Create a branch</li>
  <li>Make changes</li>
  <li>Run Unit tests</li>
  <li>Iterate</li>
  <li>Submit a PR</li>
  <li>Get a code review from at least two teammates</li>
  <li>Iterate some more</li>
  <li>Merge into Master upon approval</li>
</ol>

<p>And so on and so forth‚Ä¶ No need to overcomplicate it.</p>

<h2 id="building-and-publishing">Building and Publishing</h2>

<p>Assuming you‚Äôve followed the usual development workflow, and your changes have been merged into the Master branch, next would be to create a new Task (or Ticket) in your project management software and corresponding Task branch (e.g., <code class="highlighter-rouge">T123</code>). Give the task the same name as well as the version being published (e.g. <code class="highlighter-rouge">‚Äú0.13.0‚Äù</code>). Checkout the branch, and follow the steps below to publish a new version of a private NPM package.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If there are tests, ALL must pass!</span>
<span class="nv">$ </span>npm <span class="nb">test</span>

<span class="c"># This bumps the version and creates a git tag for you</span>
<span class="nv">$ </span>npm version &lt;segment&gt;

<span class="c"># This compiles into the lib/ directory using Babel</span>
<span class="nv">$ </span>npm run build

<span class="c"># This publishes to a NPM repo (using the NPM credentials provided by your organization)</span>
<span class="nv">$ </span>npm publish

<span class="c"># This pushes up the git tag that was created by `npm version`</span>
<span class="nv">$ </span>git push <span class="nt">--all</span> <span class="nt">--follow-tags</span>
</code></pre></div></div>

<p>Upon completion of these steps, you‚Äôll need to open a Pull Request just like you would for any other change. The diff should be extremely simple, just check the version in <code class="highlighter-rouge">package.json</code> as it should change.</p>

<h2 id="determining-versions">Determining Versions</h2>

<p>This may not align with your organization‚Äôs rulebook, and that‚Äôs okay. If you have the choice to establish Versioning guidelines, then this will hold up well for you!</p>

<p>So which version segment to bump? Often it‚Äôs best to use Semantic Versioning for shared libraries.</p>

<p>What this means is given a version number <strong>MAJOR.MINOR.PATCH</strong>, increment the:</p>

<ul>
  <li><strong>MAJOR</strong> version when you make incompatible API changes</li>
  <li><strong>MINOR</strong> version when you add functionality in a backwards-compatible manner</li>
  <li><strong>PATCH</strong> version when you make backwards-compatible bug fixes.</li>
</ul>

<p>In other words‚Ä¶</p>

<p>Bump the <strong>MAJOR</strong> version segment whenever you make a backwards-incompatible change to the interface of any utility defined in the library to be published for example:</p>

<ul>
  <li>Changing method or function signatures</li>
  <li>Changing input types</li>
  <li>Changing return value types</li>
  <li>Removing public methods or classes</li>
  <li>Changing the name or location of methods, classes, etc..</li>
</ul>

<p>Bump the <strong>MINOR</strong> version segment whenever you make a backwards-compatible change to the library that‚Äôs more than just a bug fix. Examples would be:</p>

<ul>
  <li>Adding new methods or classes</li>
  <li>Refactoring internal implementation details</li>
</ul>

<p>Bump the <strong>PATCH</strong> version segment whenever you fix a bug in a backwards-compatible manner and are not making any other changes to the library.</p>

<ul>
  <li>npm version patch</li>
</ul>

<p>Updating NPM dependencies that the library uses constitutes at minimum a <strong>MINOR</strong> version bump. If you were changing a dependency that leads to further interface-level changes or breaking side-effects, then it may constitute a <strong>MAJOR</strong> version bump.</p>

<h3 id="private-npm-credentials">Private NPM Credentials</h3>

<p>In order to publish or install private packages to and from your NPM organization, you must provide valid credentials via the <code class="highlighter-rouge">NPM_TOKEN</code> environment variable. Be sure to export it from your <code class="highlighter-rouge">~/.bash_profile</code>.</p>

<p>The one shown below is merely an example.</p>

<p><code class="highlighter-rouge">export NPM_TOKEN=28775d0b-ac16-5e5e-045f-70349z13ae75</code></p>

<p>Most importantly‚Ä¶ Do NOT commit the <code class="highlighter-rouge">NPM_TOKEN</code> value. It must be kept confidential, and if you believe it has become compromised, regenerate a new token immediately!</p>
:ET