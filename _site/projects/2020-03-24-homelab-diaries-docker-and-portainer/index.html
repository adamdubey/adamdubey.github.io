<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Homelab Diaries: Docker &amp; Portainer - adamdubey.github.io</title>
<meta name="description" content="Getting up and running with Docker and Portainer in the homelab.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="adamdubey.github.io">
<meta property="og:title" content="Homelab Diaries: Docker &amp; Portainer">
<meta property="og:url" content="http://localhost:4000/projects/2020-03-24-homelab-diaries-docker-and-portainer/">


  <meta property="og:description" content="Getting up and running with Docker and Portainer in the homelab.">







  <meta property="article:published_time" content="2020-03-24T00:00:00-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/projects/2020-03-24-homelab-diaries-docker-and-portainer/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Adam Dubey",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="adamdubey.github.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link
  rel="shortcut icon"
  type="image/x-icon"
  href="../../assets/images/favicon.ico"
/>
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">adamdubey.github.io</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/" >Projects</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/bio-photo.jpeg" alt="Adam Dubey" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Adam Dubey</h3>
    
    
      <p class="author__bio" itemprop="description">
        Intergalactic citizen of the Internet.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/adamdubey" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/adam-dubey" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Homelab Diaries: Docker &amp; Portainer">
    <meta itemprop="description" content="Getting up and running with Docker and Portainer in the homelab.">
    <meta itemprop="datePublished" content="March 24, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Homelab Diaries: Docker &amp; Portainer
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Getting up and running with Docker and Portainer in the homelab.</p>

<h1 id="portainer--docker-a-cursory-overview">Portainer &amp; Docker: A cursory overview</h1>

<p>Docker is typically described as <em>“Enterprise Container Platform for High-Velocity Innovation”</em> and that about sums it up pretty nicely…kinda. I think folks get hung up on some of the deep technical aspects which adds fuzz to the basic understanding, but basically Docker containers provide a standardized environment for your applications to live in. There are numerous ways to configure your container, such as software and operating systems, however all of the containers are sharing the same host hardware, and most importantly the kernel.</p>

<p>Portainer is simply just a management UI to manage Docker environments. I tend to live in the CLI myself, but sometimes GUIs are nice too, especially if you are managing multiple Docker environments.</p>

<p>Through several days of experimenting, multiple variations and approaches to administration and pushing the boundaries, I don’t think Portainer really fits my particular workflows other than being useful for getting granular centralized telemetry data of my Docker containers.</p>

<p>So with that being said, here are my two best approaches to working with Portainer in your own labs…</p>

<h2 id="option-1-installing-the-docker-host-vm-with-photon">Option 1: Installing the Docker Host VM with Photon</h2>

<p>For my lab stack, I’m going with Photon OS. If you haven’t used it yet within your homelab, definitely give it a go! It’s really lightweight, and pretty seamless getting an instance running in VSphere since there are both OVA and ISO files.</p>

<p>Follow the process to get the Photon OS VM created per your environment, and perform the setup steps such as changing your password.</p>

<p>Next, we will need to configure Docker, which couldn’t be any easier with PhotonOS - Just enter these two commands:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl start docker
<span class="nv">$ </span>systemctl <span class="nb">enable </span>docker
</code></pre></div></div>

<p>In a grand total of 3 minutes, I now have a VM to muck up as much as I want with Docker experiments! Not a big deal if shit goes sideways, rollback to a snapshot or just rebuild the whole VM!</p>

<h2 id="option-2-install-the-docker-host-vm-with-ubuntu">Option 2: Install the Docker Host VM with Ubuntu</h2>

<p>I have to admit that I like this option a little bit more than the prior, mainly because I don’t have to context switch as much when it comes to managing the host OS. However, this approach does take a little more time (<em>even with automation</em>), but is totally worth it - especially if you remember to snapshot the VM before proceeding…Into the Production stack will go a fresh VM with the latest Ubuntu offering!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Update system packages</span>

<span class="nv">$ </span><span class="nb">sudo </span>apt-get update
<span class="nv">$ </span><span class="nb">sudo </span>apt-get upgrade

<span class="c"># Install Docker and enable service</span>

<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>docker.io
<span class="nv">$ </span><span class="nb">sudo </span>systemctl start docker
<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>docker

<span class="c"># Fix Permissions to make Docker administration easier</span>

<span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>
<span class="nv">$ </span>su - <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>
</code></pre></div></div>

<p>And just like that, a new VM is ready and awaiting…</p>

<h2 id="configuring-portainer">Configuring Portainer</h2>

<p>Alright now it’s time to make some big decisions, and it’ll come down to answering this question:</p>

<p><em>“How do I want to administer my Docker containers?”</em></p>

<p>Typically I test out a new service in my Lab stack manually first, and then if it’s a Production service, spin it up via Docker Compose.</p>

<p>Let’s take a look at bringing up Portainer manually first:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container run <span class="nt">-d</span> <span class="se">\</span>
 <span class="nt">-p</span> 9000:9000 <span class="se">\</span>
 <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock portainer/portainer
</code></pre></div></div>

<p>And if we are going to build expressly for Production:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.yml</span>

<span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="c1">#####PORTAINER#####</span>
  <span class="na">portainer</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">portainer</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">portainer/portainer</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">portainer_data:/data</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9000:9000"</span>

<span class="c1">#####VOLUMES#####</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">portainer_data</span><span class="pi">:</span>
</code></pre></div></div>

<p>To finish the install, you can open Portainer in your web browser of choice, by navigating to your instance’s IP address followed by the port number, for example:</p>

<p><code class="highlighter-rouge">192.168.3.27:9000</code></p>

<p>And that’s it! Just follow whatever wizards lurk ahead <em>(stuff changes all the time, and whatever I write will probably be obsolete soon)</em>.</p>

<h2 id="next-steps">Next Steps</h2>

<p>Now that the service is running, you can add whatever containers you want to be monitored by Portainer, just by spinning up a new service or adding to your existing docker-compose file and re-building.</p>

<p>As an example, here is my current Lab stack testing a TIG stack <em>(Telegraf, InfluxDB, Grafana)</em> for centralized telemetry:</p>

<p><img src="/assets/images/portainer/portainer-overview.png" alt="portainer-dashboard" /></p>

<p>Just by having the Docker containers all running on the same host, Portainer is able to capture and display them in a single spot.</p>

<p>Happy experimenting!</p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-03-24T00:00:00-05:00">March 24, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/projects/2020-02-14-bad-janet/" class="pagination--pager" title="Bad Janet
">Previous</a>
    
    
      <a href="/projects/2020-04-03-a-fancy-cookbook/" class="pagination--pager" title="A Fancy Cookbook
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/adamdubey" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/adam-dubey" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Adam Dubey. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>








  </body>
</html>
